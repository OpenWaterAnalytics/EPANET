<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OWA-EPANET Toolkit 2.3: Chlorine Dosage Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">OWA-EPANET Toolkit 2.3
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_example4.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Chlorine Dosage Example</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example illustrates how the Toolkit could be used to determine the lowest dose of chlorine applied at the entrance to a distribution system needed to ensure that a minimum residual is met throughout the system. We assume that the EPANET input file contains the proper set of kinetic coefficients that describe the rate at which chlorine will decay in the system being studied. In the example code, the ID label of the source node is contained in <code>SourceID</code>, the minimum residual target is given by <code>Ctarget</code>, and the target is only checked after a start-up duration of 5 days (432,000 seconds). To keep the code more readable, no error checking is made on the results returned from the Toolkit function calls.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="epanet2__2_8h.html">epanet2_2.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> cl2dose(<span class="keywordtype">char</span> *SourceID, <span class="keywordtype">double</span> Ctarget)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i, nnodes, sourceindex, violation;</div>
<div class="line">    <span class="keywordtype">double</span> c, csource;</div>
<div class="line">    <span class="keywordtype">long</span> t, tstep;</div>
<div class="line">    <a class="code hl_typedef" href="epanet2__2_8h.html#ac1b7237e65fbaad96c05cc847adc0aeb">EN_Project</a> ph;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open the toolkit &amp; obtain a hydraulic solution</span></div>
<div class="line">    <a class="code hl_function" href="group___project.html#ga550a6ee3432932edce526c6cf0e0742e">EN_createproject</a>(&amp;ph);</div>
<div class="line">    <a class="code hl_function" href="group___project.html#gabda293c7ce17814fc886ecb1f71ecdf1">EN_open</a>(ph, <span class="stringliteral">&quot;example3.inp&quot;</span>, <span class="stringliteral">&quot;example3.rpt&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">    <a class="code hl_function" href="group___hydraulics.html#gaaa7aaf68ebb9c8c6709489073fc08f8e">EN_solveH</a>(ph);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get the number of nodes and the source node&#39;s index</span></div>
<div class="line">    <a class="code hl_function" href="group___project.html#gac3083cec1ade11773c162f8359aa9f43">EN_getcount</a>(ph, <a class="code hl_enumvalue" href="epanet2__enums_8h.html#ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623">EN_NODECOUNT</a>, &amp;nnodes);</div>
<div class="line">    <a class="code hl_function" href="group___nodes.html#ga883d7add8e651be1a52abb0b18dc32a2">EN_getnodeindex</a>(ph, SourceID, &amp;sourceindex);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup the system to analyze for chlorine</span></div>
<div class="line">    <span class="comment">// (in case it was not done in the input file)</span></div>
<div class="line">    <a class="code hl_function" href="group___options.html#ga77360a062c8ddffe97de2daf0d8e0b83">EN_setqualtype</a>(ph, <a class="code hl_enumvalue" href="epanet2__enums_8h.html#ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718">EN_CHEM</a>, <span class="stringliteral">&quot;Chlorine&quot;</span>, <span class="stringliteral">&quot;mg/L&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Open the water quality solver</span></div>
<div class="line">    <a class="code hl_function" href="group___quality.html#ga1e8b2e81f5310d43afbe3aada5027f83">EN_openQ</a>(ph);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Begin the search for the source concentration</span></div>
<div class="line">    csource = 0.0;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update source concentration to next level</span></div>
<div class="line">        csource = csource + 0.1;</div>
<div class="line">        <a class="code hl_function" href="group___nodes.html#ga4f3dcdb87c15a064b7fed1131d5287bb">EN_setnodevalue</a>(ph, sourceindex, <a class="code hl_enumvalue" href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6">EN_SOURCEQUAL</a>, csource);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Run WQ simulation checking for target violations</span></div>
<div class="line">        violation = 0;</div>
<div class="line">        <a class="code hl_function" href="group___quality.html#ga68bfa6606604bf0cedcbc12591749f2c">EN_initQ</a>(ph, 0);</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            <a class="code hl_function" href="group___quality.html#ga5ce5c77c9af21711e6b68b90e0512ff9">EN_runQ</a>(ph, &amp;t);</div>
<div class="line">            <span class="keywordflow">if</span> (t &gt; 432000) {</div>
<div class="line">                <span class="keywordflow">for</span> (i=1; i&lt;=nnodes; i++) {</div>
<div class="line">                    <a class="code hl_function" href="group___nodes.html#ga364c0ae5843d585148313b61e88dd1ac">EN_getnodevalue</a>(ph, i, <a class="code hl_enumvalue" href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8">EN_QUALITY</a>, &amp;c);</div>
<div class="line">                    <span class="keywordflow">if</span> (c &lt; Ctarget) {</div>
<div class="line">                        violation = 1;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <a class="code hl_function" href="group___quality.html#ga620133212b97123394de17c9d49a1765">EN_nextQ</a>(ph, &amp;tstep);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// End WQ run if violation found</span></div>
<div class="line">        } <span class="keywordflow">while</span> (!violation &amp;&amp; tstep &gt; 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Continue search if violation found</span></div>
<div class="line">    } <span class="keywordflow">while</span> (violation &amp;&amp; csource &lt;= 4.0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close up the WQ solver and delete the project</span></div>
<div class="line">    <a class="code hl_function" href="group___quality.html#gac34d2e8ca6ab7d07475570530a7fdda3">EN_closeQ</a>(ph);</div>
<div class="line">    <a class="code hl_function" href="group___project.html#ga46d6b8494c80d2f20bac8ec1d0454c6b">EN_deleteproject</a>(ph);</div>
<div class="line">    <span class="keywordflow">return</span> csource;</div>
<div class="line">}</div>
<div class="ttc" id="aepanet2__2_8h_html"><div class="ttname"><a href="epanet2__2_8h.html">epanet2_2.h</a></div></div>
<div class="ttc" id="aepanet2__2_8h_html_ac1b7237e65fbaad96c05cc847adc0aeb"><div class="ttname"><a href="epanet2__2_8h.html#ac1b7237e65fbaad96c05cc847adc0aeb">EN_Project</a></div><div class="ttdeci">struct Project * EN_Project</div><div class="ttdoc">The EPANET Project wrapper object.</div><div class="ttdef"><b>Definition</b> epanet2_2.h:49</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718"><div class="ttname"><a href="epanet2__enums_8h.html#ga7b8b382d79f8829962c5fe3172ac4d13a1b741c34120cef94de4c429f7f587718">EN_CHEM</a></div><div class="ttdeci">@ EN_CHEM</div><div class="ttdoc">Chemical fate and transport.</div><div class="ttdef"><b>Definition</b> epanet2_enums.h:250</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623"><div class="ttname"><a href="epanet2__enums_8h.html#ga9fab0d1b11a0670601f9bc4dfa670105a9506750f3b6412c8d871509977417623">EN_NODECOUNT</a></div><div class="ttdeci">@ EN_NODECOUNT</div><div class="ttdoc">Number of nodes (junctions + tanks + reservoirs)</div><div class="ttdef"><b>Definition</b> epanet2_enums.h:182</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6"><div class="ttname"><a href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da0a1b1170bca5d2b8e898f9cc74749bc6">EN_SOURCEQUAL</a></div><div class="ttdeci">@ EN_SOURCEQUAL</div><div class="ttdoc">Quality source strength.</div><div class="ttdef"><b>Definition</b> epanet2_enums.h:42</div></div>
<div class="ttc" id="aepanet2__enums_8h_html_gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8"><div class="ttname"><a href="epanet2__enums_8h.html#gae538c7e564d9bd7c5a1f841b107c417da828ef7fd7bc79ddc7cdf1c0eb7d5a9a8">EN_QUALITY</a></div><div class="ttdeci">@ EN_QUALITY</div><div class="ttdoc">Current computed quality (read only)</div><div class="ttdef"><b>Definition</b> epanet2_enums.h:49</div></div>
<div class="ttc" id="agroup___hydraulics_html_gaaa7aaf68ebb9c8c6709489073fc08f8e"><div class="ttname"><a href="group___hydraulics.html#gaaa7aaf68ebb9c8c6709489073fc08f8e">EN_solveH</a></div><div class="ttdeci">int DLLEXPORT EN_solveH(EN_Project ph)</div><div class="ttdoc">Runs a complete hydraulic simulation with results for all time periods written to a temporary hydraul...</div></div>
<div class="ttc" id="agroup___nodes_html_ga364c0ae5843d585148313b61e88dd1ac"><div class="ttname"><a href="group___nodes.html#ga364c0ae5843d585148313b61e88dd1ac">EN_getnodevalue</a></div><div class="ttdeci">int DLLEXPORT EN_getnodevalue(EN_Project ph, int index, int property, double *out_value)</div><div class="ttdoc">Retrieves a property value for a node.</div></div>
<div class="ttc" id="agroup___nodes_html_ga4f3dcdb87c15a064b7fed1131d5287bb"><div class="ttname"><a href="group___nodes.html#ga4f3dcdb87c15a064b7fed1131d5287bb">EN_setnodevalue</a></div><div class="ttdeci">int DLLEXPORT EN_setnodevalue(EN_Project ph, int index, int property, double value)</div><div class="ttdoc">Sets a property value for a node.</div></div>
<div class="ttc" id="agroup___nodes_html_ga883d7add8e651be1a52abb0b18dc32a2"><div class="ttname"><a href="group___nodes.html#ga883d7add8e651be1a52abb0b18dc32a2">EN_getnodeindex</a></div><div class="ttdeci">int DLLEXPORT EN_getnodeindex(EN_Project ph, const char *id, int *out_index)</div><div class="ttdoc">Gets the index of a node given its ID name.</div></div>
<div class="ttc" id="agroup___options_html_ga77360a062c8ddffe97de2daf0d8e0b83"><div class="ttname"><a href="group___options.html#ga77360a062c8ddffe97de2daf0d8e0b83">EN_setqualtype</a></div><div class="ttdeci">int DLLEXPORT EN_setqualtype(EN_Project ph, int qualType, const char *chemName, const char *chemUnits, const char *traceNode)</div><div class="ttdoc">Sets the type of water quality analysis to run.</div></div>
<div class="ttc" id="agroup___project_html_ga46d6b8494c80d2f20bac8ec1d0454c6b"><div class="ttname"><a href="group___project.html#ga46d6b8494c80d2f20bac8ec1d0454c6b">EN_deleteproject</a></div><div class="ttdeci">int DLLEXPORT EN_deleteproject(EN_Project ph)</div><div class="ttdoc">Deletes a currently opened EPANET project.</div></div>
<div class="ttc" id="agroup___project_html_ga550a6ee3432932edce526c6cf0e0742e"><div class="ttname"><a href="group___project.html#ga550a6ee3432932edce526c6cf0e0742e">EN_createproject</a></div><div class="ttdeci">int DLLEXPORT EN_createproject(EN_Project *ph)</div><div class="ttdoc">Creates an EPANET project.</div></div>
<div class="ttc" id="agroup___project_html_gabda293c7ce17814fc886ecb1f71ecdf1"><div class="ttname"><a href="group___project.html#gabda293c7ce17814fc886ecb1f71ecdf1">EN_open</a></div><div class="ttdeci">int DLLEXPORT EN_open(EN_Project ph, const char *inpFile, const char *rptFile, const char *outFile)</div><div class="ttdoc">Reads an EPANET input file with no errors allowed.</div></div>
<div class="ttc" id="agroup___project_html_gac3083cec1ade11773c162f8359aa9f43"><div class="ttname"><a href="group___project.html#gac3083cec1ade11773c162f8359aa9f43">EN_getcount</a></div><div class="ttdeci">int DLLEXPORT EN_getcount(EN_Project ph, int object, int *out_count)</div><div class="ttdoc">Retrieves the number of objects of a given type in a project.</div></div>
<div class="ttc" id="agroup___quality_html_ga1e8b2e81f5310d43afbe3aada5027f83"><div class="ttname"><a href="group___quality.html#ga1e8b2e81f5310d43afbe3aada5027f83">EN_openQ</a></div><div class="ttdeci">int DLLEXPORT EN_openQ(EN_Project ph)</div><div class="ttdoc">Opens a project&#39;s water quality solver.</div></div>
<div class="ttc" id="agroup___quality_html_ga5ce5c77c9af21711e6b68b90e0512ff9"><div class="ttname"><a href="group___quality.html#ga5ce5c77c9af21711e6b68b90e0512ff9">EN_runQ</a></div><div class="ttdeci">int DLLEXPORT EN_runQ(EN_Project ph, long *out_currentTime)</div><div class="ttdoc">Makes hydraulic and water quality results at the start of the current time period available to a proj...</div></div>
<div class="ttc" id="agroup___quality_html_ga620133212b97123394de17c9d49a1765"><div class="ttname"><a href="group___quality.html#ga620133212b97123394de17c9d49a1765">EN_nextQ</a></div><div class="ttdeci">int DLLEXPORT EN_nextQ(EN_Project ph, long *out_tStep)</div><div class="ttdoc">Advances a water quality simulation over the time until the next hydraulic event.</div></div>
<div class="ttc" id="agroup___quality_html_ga68bfa6606604bf0cedcbc12591749f2c"><div class="ttname"><a href="group___quality.html#ga68bfa6606604bf0cedcbc12591749f2c">EN_initQ</a></div><div class="ttdeci">int DLLEXPORT EN_initQ(EN_Project ph, int saveFlag)</div><div class="ttdoc">Initializes a network prior to running a water quality analysis.</div></div>
<div class="ttc" id="agroup___quality_html_gac34d2e8ca6ab7d07475570530a7fdda3"><div class="ttname"><a href="group___quality.html#gac34d2e8ca6ab7d07475570530a7fdda3">EN_closeQ</a></div><div class="ttdeci">int DLLEXPORT EN_closeQ(EN_Project ph)</div><div class="ttdoc">Closes the water quality solver, freeing all of its allocated memory.</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="_toolkit_examples.html">Examples</a></li>
<!--    <li class="footer">OWA-EPANET Toolkit 2.3 &copy 2025</li> -->
  </ul>
</div>
</body>
</html>
